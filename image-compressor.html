-<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Image Compressor - GET Tools</title>

<style>
body{
font-family:Arial;
background:#f3f3f3;
margin:0;
padding:20px;
text-align:center;
}

.dimension-toggle{
display:inline-block;
background:#eee;
padding:8px 15px;
border-radius:20px;
margin-bottom:20px;
}

.dimension-toggle button{
border:none;
background:none;
padding:6px 12px;
cursor:pointer;
font-weight:bold;
}

.dimension-toggle .active{
background:#d6d6d6;
border-radius:15px;
}

.upload-area{
border:3px dashed #8a8ad4;
border-radius:15px;
padding:60px;
margin-bottom:20px;
background:white;
cursor:pointer;
}

.card{
width:320px;
margin:auto;
background:#49799c;
color:white;
border-radius:10px;
display:none;
overflow:hidden;
}

.preview-box{
background:white;
padding:15px;
position:relative;
}

.preview-box img{
max-width:100%;
}
.modal{
display:none;
position:fixed;
z-index:999;
left:0;
top:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.7);
}

.modal-content{
background:#1e1e1e;
color:white;
width:400px;
padding:20px;
margin:8% auto;
border-radius:10px;
text-align:center;
position:relative;
}

.close{
position:absolute;
right:15px;
top:10px;
font-size:22px;
cursor:pointer;
}

.modal input{
margin:5px;
padding:8px;
width:120px;
}
.top-btn{
position:absolute;
top:10px;
left:10px;
}

.top-btn button{
background:#3b6e90;
color:white;
border:none;
padding:5px 10px;
margin:3px;
border-radius:20px;
cursor:pointer;
font-size:12px;
}

.close-btn{
position:absolute;
top:10px;
right:10px;
cursor:pointer;
font-weight:bold;
}

.info{
padding:15px;
text-align:left;
}

.controls{
margin-top:30px;
}

.reduce-btn{
background:#5661b3;
color:white;
border:none;
padding:10px 20px;
border-radius:6px;
cursor:pointer;
}
</style>
</head>
<body>

<div class="dimension-toggle">
Image Dimensions:-
<button class="active" onclick="setUnit('px',this)">Pixels</button>
<button onclick="setUnit('mm',this)">MM</button>
<button onclick="setUnit('cm',this)">CM</button>
</div>

<div class="upload-area" onclick="fileInput.click()">
Click or Drag Image Here
<input type="file" id="fileInput" accept="image/*" hidden>
</div>

<div class="card" id="card">

<div class="preview-box">
<div class="top-btn">
<button onclick="openResizeModal()">Resize Pixel</button>
  <div id="resizeModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeResizeModal()">&times;</span>
    <h2>Resize Image</h2>

    <label>Width</label>
    <input type="number" id="resizeWidth">

    <label>Height</label>
    <input type="number" id="resizeHeight">

    <div id="dpiBox" style="display:none;">
      <label>DPI</label>
      <input type="number" id="resizeDpi" value="300">
    </div>

    <br>
    <label>
      <input type="checkbox" id="resizeRatio" checked>
      Maintain Aspect Ratio
    </label>

    <br><br>
    <button onclick="applyResize()">Apply Resize</button>
  </div>
</div>


  
<button onclick="cropImage()">Crop</button>
</div>
<div class="close-btn" onclick="removeImage()">✖</div>
<img id="preview">
</div>

<div class="info">
<p id="fileName"></p>
<p><strong>Size:</strong> <span id="fileSize"></span></p>
<p><strong>Width:</strong> <span id="imgWidth"></span></p>
<p><strong>Height:</strong> <span id="imgHeight"></span></p>

<hr>

DPI: <input type="number" id="dpi" value="300" style="width:70px;"><br><br>
Width: <input type="number" id="resizeWidth" style="width:80px;">
Height: <input type="number" id="resizeHeight" style="width:80px;">

</div>

</div>

<div class="controls">
Size: <input type="number" id="targetSize" value="100" style="width:70px;"> KB
<button class="reduce-btn" onclick="compress()">Reduce Size</button>
</div>

<script>


  let originalWidth, originalHeight;
let currentUnit = "px"; // px / mm / cm (তুমি যেটা use করছো)

function openResizeModal(){

let preview = document.getElementById("preview");

if(!preview.src){
alert("Upload image first");
return;
}

originalWidth = preview.naturalWidth;
originalHeight = preview.naturalHeight;

document.getElementById("resizeWidth").value = originalWidth;
document.getElementById("resizeHeight").value = originalHeight;

document.getElementById("resizeModal").style.display="block";
}

function closeResizeModal(){
document.getElementById("resizeModal").style.display="none";
}

document.getElementById("resizeWidth").addEventListener("input", function(){
if(!document.getElementById("resizeRatio").checked) return;
let ratio = originalHeight/originalWidth;
document.getElementById("resizeHeight").value = (this.value*ratio).toFixed(2);
});

document.getElementById("resizeHeight").addEventListener("input", function(){
if(!document.getElementById("resizeRatio").checked) return;
let ratio = originalWidth/originalHeight;
document.getElementById("resizeWidth").value = (this.value*ratio).toFixed(2);
});

function applyResize(){

let preview = document.getElementById("preview");

let w = document.getElementById("resizeWidth").value;
let h = document.getElementById("resizeHeight").value;

let canvas=document.createElement("canvas");
canvas.width=w;
canvas.height=h;

let ctx=canvas.getContext("2d");
ctx.drawImage(preview,0,0,w,h);

preview.src = canvas.toDataURL("image/jpeg",1);

originalWidth=w;
originalHeight=h;

closeResizeModal();
}


  
let originalFile;
let currentUnit="px";
let imgWidthPx, imgHeightPx;

const fileInput=document.getElementById("fileInput");

fileInput.addEventListener("change",function(e){
let file=e.target.files[0];
if(!file) return;

originalFile=file;

let reader=new FileReader();
reader.onload=function(event){

let img=new Image();
img.src=event.target.result;

img.onload=function(){

imgWidthPx=img.width;
imgHeightPx=img.height;

document.getElementById("preview").src=event.target.result;
document.getElementById("fileName").innerText=file.name;
document.getElementById("fileSize").innerText=(file.size/1024).toFixed(2)+" KB";

updateDimensions();

document.getElementById("resizeWidth").value=imgWidthPx;
document.getElementById("resizeHeight").value=imgHeightPx;

document.getElementById("card").style.display="block";
};
};
reader.readAsDataURL(file);
});

function setUnit(unit,btn){
currentUnit=unit;
document.querySelectorAll(".dimension-toggle button").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
updateDimensions();
}

function updateDimensions(){
let w=imgWidthPx;
let h=imgHeightPx;

if(currentUnit==="mm"){
w=(w*0.2646).toFixed(1);
h=(h*0.2646).toFixed(1);
}
if(currentUnit==="cm"){
w=(w*0.02646).toFixed(2);
h=(h*0.02646).toFixed(2);
}

document.getElementById("imgWidth").innerText=w+" "+currentUnit.toUpperCase();
document.getElementById("imgHeight").innerText=h+" "+currentUnit.toUpperCase();
}

function removeImage(){
document.getElementById("card").style.display="none";
fileInput.value="";
}

function resizeImage(){

let preview = document.getElementById("preview");

if(!preview || !preview.src){
alert("Upload image first");
return;
}

// IMPORTANT
localStorage.setItem("resizeImageData", preview.src);
localStorage.setItem("resizeUnit", currentUnit); // px / mm / cm

window.open("resize.html","_blank");

}
function cropImage(){
alert("Crop feature can be integrated with canvas crop system");
}

function compress(){

if(!originalFile){
alert("Upload image first");
return;
}

let targetKB=document.getElementById("targetSize").value;
let maxBytes=targetKB*1024;

let img=new Image();
img.src=document.getElementById("preview").src;

img.onload=function(){

let canvas=document.createElement("canvas");
canvas.width=img.width;
canvas.height=img.height;

let ctx=canvas.getContext("2d");
ctx.drawImage(img,0,0);

let quality=0.9;
let compressed=canvas.toDataURL("image/jpeg",quality);

while((compressed.length*3/4)>maxBytes && quality>0.1){
quality-=0.05;
compressed=canvas.toDataURL("image/jpeg",quality);
}

document.getElementById("preview").src=compressed;
};
}

</script>

</body>
</html>
