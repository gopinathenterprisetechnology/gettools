<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Image Compressor Pro v2.0</title>
<style>
body{
margin:0;
font-family:Segoe UI;
background:#0f172a;
color:white;
display:flex;
justify-content:center;
align-items:center;
min-height:100vh;
}

.container{
width:900px;
background:#1e293b;
padding:25px;
border-radius:15px;
box-shadow:0 0 30px rgba(0,0,0,0.5);
}

h1{
text-align:center;
margin-bottom:20px;
}

.drop-zone{
border:2px dashed #38bdf8;
padding:30px;
text-align:center;
cursor:pointer;
border-radius:10px;
margin-bottom:20px;
}

.preview-area{
display:flex;
gap:20px;
margin-top:20px;
}

.preview-box{
flex:1;
background:#0f172a;
padding:10px;
border-radius:10px;
text-align:center;
}

.preview-box img{
max-width:100%;
max-height:250px;
}

.controls{
margin-top:20px;
display:grid;
grid-template-columns:1fr 1fr;
gap:15px;
}

input,select{
padding:8px;
border-radius:5px;
border:none;
}

button{
padding:10px;
border:none;
border-radius:6px;
cursor:pointer;
background:#38bdf8;
color:black;
font-weight:bold;
}

button:hover{
background:#0ea5e9;
}

.footer{
margin-top:15px;
text-align:center;
font-size:14px;
color:#94a3b8;
}
</style>
</head>
<body>

<div class="container">
<h1>Image Compressor Pro v2.0</h1>

<div class="drop-zone" id="dropZone">
Click or Drag Image Here
<input type="file" id="fileInput" hidden>
</div>

<div class="preview-area">
<div class="preview-box">
<h3>Original</h3>
<img id="originalPreview">
<p id="originalSize"></p>
</div>

<div class="preview-box">
<h3>Compressed</h3>
<img id="compressedPreview">
<p id="compressedSize"></p>
</div>
</div>

<div class="controls">
<div>
<label>Quality (JPG/WEBP)</label>
<input type="range" id="quality" min="0.1" max="1" step="0.1" value="0.8">
</div>

<div>
<label>Format</label>
<select id="format">
<option value="image/jpeg">JPG</option>
<option value="image/webp">WEBP</option>
<option value="image/png">PNG</option>
</select>
</div>

<div>
<label>Resize Unit</label>
<select id="unit">
<option value="px">Pixel</option>
<option value="mm">Millimeter</option>
<option value="cm">Centimeter</option>
</select>
</div>

<div>
<label>DPI (mm/cm only)</label>
<input type="number" id="dpi" value="300">
</div>

<div>
<label>Width</label>
<input type="number" id="width">
</div>

<div>
<label>Height</label>
<input type="number" id="height">
</div>

<div>
<label><input type="checkbox" id="ratio" checked> Maintain Aspect Ratio</label>
</div>

<div>
<button onclick="compressImage()">Compress</button>
<button onclick="downloadImage()">Download</button>
<button onclick="resetAll()">Reset</button>
</div>

</div>

<div class="footer">
Professional Image Compressor â€“ Upgrade Edition
</div>

</div>

<script>
const dropZone = document.getElementById("dropZone");
const fileInput = document.getElementById("fileInput");

// Click to open file
dropZone.addEventListener("click", () => {
    fileInput.click();
});

// File select
fileInput.addEventListener("change", function(e){
    if(e.target.files.length > 0){
        loadImage(e.target.files[0]);
    }
});

// Drag over effect
dropZone.addEventListener("dragover", function(e){
    e.preventDefault();
    dropZone.style.borderColor = "#22c55e";
});

// Drag leave
dropZone.addEventListener("dragleave", function(){
    dropZone.style.borderColor = "#38bdf8";
});

// Drop file
dropZone.addEventListener("drop", function(e){
    e.preventDefault();
    dropZone.style.borderColor = "#38bdf8";

    if(e.dataTransfer.files.length > 0){
        loadImage(e.dataTransfer.files[0]);
    }
});
let originalImage;
let originalWidth;
let originalHeight;
let compressedBlob;

const widthInput=document.getElementById("width");
const heightInput=document.getElementById("height");
const unitSelect=document.getElementById("unit");
const dpiInput=document.getElementById("dpi");


// ===== Target KB Input Add =====
const targetKBInput=document.createElement("input");
targetKBInput.type="number";
targetKBInput.placeholder="Target Size (KB)";
targetKBInput.style.padding="8px";
document.querySelector(".controls").appendChild(targetKBInput);


// ===== Unit Label =====
const widthLabel=document.createElement("span");
const heightLabel=document.createElement("span");

widthInput.after(widthLabel);
heightInput.after(heightLabel);


// ===== Load Image =====
function loadImage(file){
const reader=new FileReader();
reader.onload=function(e){
originalImage=new Image();
originalImage.onload=function(){
originalWidth=this.width;
originalHeight=this.height;

document.getElementById("originalPreview").src=this.src;
document.getElementById("originalSize").innerText=(file.size/1024).toFixed(2)+" KB";

updateUnitValues("px");
};
originalImage.src=e.target.result;
};
reader.readAsDataURL(file);
}


// ===== Maintain Ratio =====
document.getElementById("ratio").onchange=()=>{};
widthInput.oninput=updateRatio;
heightInput.oninput=updateRatio;

function updateRatio(){
if(!document.getElementById("ratio").checked)return;
let w=widthInput.value;
let ratio=originalHeight/originalWidth;
heightInput.value=(w*ratio).toFixed(2);
}


// ===== Convert =====
function pxToMM(px){return (px/dpiInput.value)*25.4;}
function pxToCM(px){return (px/dpiInput.value)*2.54;}
function mmToPX(mm){return (mm/25.4)*dpiInput.value;}
function cmToPX(cm){return (cm/2.54)*dpiInput.value;}


// ===== Update Unit =====
unitSelect.onchange=function(){
updateUnitValues(this.value);
};

function updateUnitValues(unit){

if(unit==="px"){
widthInput.value=originalWidth;
heightInput.value=originalHeight;
widthLabel.innerText=" px";
heightLabel.innerText=" px";
}

if(unit==="mm"){
widthInput.value=pxToMM(originalWidth).toFixed(2);
heightInput.value=pxToMM(originalHeight).toFixed(2);
widthLabel.innerText=" mm";
heightLabel.innerText=" mm";
}

if(unit==="cm"){
widthInput.value=pxToCM(originalWidth).toFixed(2);
heightInput.value=pxToCM(originalHeight).toFixed(2);
widthLabel.innerText=" cm";
heightLabel.innerText=" cm";
}
}


// ===== Convert To Pixel For Canvas =====
function convertToPixel(value){
let unit=unitSelect.value;

if(unit==="px")return value;
if(unit==="mm")return mmToPX(value);
if(unit==="cm")return cmToPX(value);
}


// ===== Smart Target KB Compression =====
async function compressImage(){

let canvas=document.createElement("canvas");
let ctx=canvas.getContext("2d");

let w=convertToPixel(widthInput.value);
let h=convertToPixel(heightInput.value);

canvas.width=w;
canvas.height=h;
ctx.drawImage(originalImage,0,0,w,h);

let format=document.getElementById("format").value;
let targetKB=targetKBInput.value;

let quality=0.9;
let blob;

if(targetKB){

let targetBytes=targetKB*1024;

for(let q=0.9;q>0.1;q-=0.05){

blob=await new Promise(resolve=>{
canvas.toBlob(resolve,format,q);
});

if(blob.size<=targetBytes){
quality=q;
break;
}
}
}else{

quality=document.getElementById("quality").value;
blob=await new Promise(resolve=>{
canvas.toBlob(resolve,format,quality);
});
}

compressedBlob=blob;

document.getElementById("compressedPreview").src=URL.createObjectURL(blob);
document.getElementById("compressedSize").innerText=(blob.size/1024).toFixed(2)+" KB";
}


// ===== Download =====
function downloadImage(){
if(!compressedBlob)return alert("Compress first!");
let a=document.createElement("a");
a.href=URL.createObjectURL(compressedBlob);
a.download="compressed-image";
a.click();
}

</script>

</body>
</html>
